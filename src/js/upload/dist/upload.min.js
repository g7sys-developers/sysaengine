class uploadHtml{constructor(){this._input,this._multiple=!1,this._required=!1,this._allowedImgTag=["jpg","png","webp","bmp","jpeg","gif","svg"],this._loadedGallery={html:[],grid2:[]}}galeriaGrid2(e){"undefined"!=typeof jsaa&&0!==this._arquivosGaleria.length&&(jsaa.grid_object[e].set_grid_informations({grid_id:e,datalist:[...this._arquivosGaleria]}),-1===this._loadedGallery.grid2.indexOf(e)&&this._loadedGallery.grid2.push(e))}geraGaleria(e){if(null===(e=e instanceof HTMLElement?e:document.getElementById(e))||0===this._arquivosGaleria.length)return;console.log(this._arquivosGaleria);let i="";for(let e of this._arquivosGaleria)i+='<li>                <div class="btn-group" style="position:absolute; top:0; right:0;">                    <a class="btn btn-mini btn-inverse dropdown-toggle" data-toggle="dropdown" href="javascript: void(0);">                        <i class="icon-th icon-white"></i>                        <span class="caret"></span>                    </a>                    <ul class="dropdown-menu">                        <li><a tabindex="-1" href="'+e.bucket_url_base+e.name_file+'" target="_blank">Visualizar</a></li>                        '+(this._permiteExcluir?'<li class="divider"></li>                        <li><a tabindex="-1" data-toggle="up2ExcluiArquivo" data-id="'+e.id_filecenter+'" href="#">Excluir</a></li>':"")+'                    </ul>                </div>                <a href="'+e.bucket_url_base+e.name_file+'" target="_blank" class="thumbnail">                    '+(this._allowedImgTag.indexOf(e.filetype)>-1?'<img src="'+e.bucket_url_base+e.name_file+'" alt="'+e.filetype+'">':'<div class="others-files">'+e.filetype+"</div>")+"                </a>            </li>";e.innerHTML=i;let t=e.querySelectorAll('a[data-toggle="up2ExcluiArquivo"]');if(0===t.length)return;let a=this;for(let e of t)e.addEventListener("click",(e=>{a.deleteArquivo(e)}));-1===this._loadedGallery.html.indexOf(e)&&this._loadedGallery.html.push(e)}setInput(e){if(!(e instanceof HTMLInputElement)||"file"!==e.getAttribute("type").toLowerCase()||void 0!==this._input)return!1;this._input=e,this._multiple=e.multiple,this._required=e.required;let i=this;return this._input.addEventListener("change",(()=>i.onSelectFiles())),!0}onSelectFiles(){this.verificaArquivosSelecionados()}getInput(){return this._input instanceof HTMLInputElement&&"file"===this._input.getAttribute("type").toLowerCase()?this._input:null}isMultiple(){return this._multiple}isRequired(){return this._required}}class upload extends uploadHtml{constructor(){super();let e=location.href.replace(/\?.*/g,"");e=e.substr(0,e.lastIndexOf("/"))+"/",this._initialUrl=e,this._urlBase="ajax/sysaengine/",this._verifyFile="pesquisa_dados_galeria.php",this._randomKey="95BD84A89896826954ADF71A851F4",this._header=new Headers,this._header.append("Secuitykey",this._randomKey),this._extensoesProibidas=["php","js","bat","sh","exe","com","reg","cmd","bin","csh","ksh","out","run"],this._maxSize=20971520,this._extensaoPermitidas=[],this._erros=[],this._id_filecenter_gallery,this._filesInGallery=[],this._uploadFile="upload.php",this._uploadFileTemp="uploadTemp.php",this._loadFile="carrega_galeria.php",this._deleteFile="deleta_arquivo_gcloud.php",this._arquivosGaleria=[],this._uploadTemporario=!1,this._permiteExcluir=!1,this._callbacks={antesDeletar:[],antesInserir:[],depoisSelecionar:[]}}pegaIdGaleria=()=>this._id_filecenter_gallery;permitirExcluirArquivos=()=>this._permiteExcluir=!0;uploadTemporario=()=>this._uploadTemporario=!0;verificaExtensoesProibida=e=>this._extensoesProibidas.indexOf(e)>-1;verificaExtensoesEscolhidas=e=>this._extensaoPermitidas.indexOf(e)>-1;adicionaCallbackDelete=e=>{if("function"!=typeof e)return this;this._callbacks.antesDeletar.push(e)};adicionaCallbackInserir=e=>{if("function"!=typeof e)return this;this._callbacks.antesInserir.push(e)};adicionaCallbackDepoisSelecionar=e=>{if("function"!=typeof e)return this;this._callbacks.depoisSelecionar.push(e)};setaArquivosGaleria=e=>{if(this._arquivosGaleria=[...e],this._loadedGallery.html.length>0)for(let e of this._loadedGallery.html)this.geraGaleria(e);if(this._loadedGallery.grid2.length>0)for(let e of this._loadedGallery.grid2)this.galeriaGrid2(e)};deleteArquivoPorId=async e=>{let i=this._arquivosGaleria.find((i=>e==i.id_filecenter));if(void 0===i)return void console.log("O arquivo não foi carregado nessa galeria. Para deletá-lo o arquivo precisa estar carregado!");if(this._callbacks.antesDeletar.length>0)for(let e of this._callbacks.antesDeletar)if(!e(i))return console.log("O arquivo não pode ser deletado pois foi negado pela função abaixo."),void console.log(e);this._header.delete("Content-Type"),this._header.append("Content-type","application/json");let t=await fetch(this._initialUrl+this._urlBase+this._deleteFile,{method:"POST",headers:this._header,body:JSON.stringify(i)}),a=await t.json();return this.setaArquivosGaleria(a),new Promise(((e,i)=>{e(a)}))};deleteArquivo=async({target:e})=>{if(!confirm("Deseja deletar este arquivo?"))return;let i=e.getAttribute("data-id");return this.deleteArquivoPorId(i)};pegaExtensaoArquivo=e=>e.match(/(?<=\.)[a-zA-Z0-9]{2,}$/gi);pegaArquivos=()=>this._input.files;pegaErros=()=>this._erros;contaArquivos=()=>this._input.files.length;pegaMaxSize=()=>this._maxSize;pegaExtensaoPermitida=()=>this._extensaoPermitidas;unloadGaleria=()=>{this._id_filecenter_gallery=null,this._arquivosGaleria=[]};carregaGaleria=async e=>{this._header.delete("Content-Type"),this._header.append("Content-type","application/json");let i=await fetch(this._initialUrl+this._urlBase+this._verifyFile,{method:"POST",headers:this._header,body:JSON.stringify({verificar:"carregaGaleria",id_filecenter_gallery:e})});if(i.ok){let t=await i.json();return this._id_filecenter_gallery=e,this.setaArquivosGaleria(t),new Promise(((e,i)=>{e(t)}))}};setaMaxSize=e=>(/^[0-9]{1,}$/g.test(e)&&(this._maxSize=e),this);setaExtensaoPermitida=e=>{if(e=e.toLowerCase(),!(this._extensoesProibidas.indexOf(e)>-1))return this._extensaoPermitidas.push(e),this;console.log("A extensão "+e+" está na lista de extensões proíbidas! Essa extensão representa algum risco ao sistema e por isso não é permitida!")};verificaArquivosSelecionados=()=>{if(this._erros=[],0==this._input.files.length)return this._erros.push("Nenhum arquivo selecionado."),!1;let e=[];for(let i of this._input.files){let t=this.pegaExtensaoArquivo(i.name);(i.size>this._maxSize||this._extensoesProibidas.indexOf(t.join(""))>-1||this._extensaoPermitidas.length>0&&-1===this._extensaoPermitidas.indexOf(t.join("")))&&e.push(i.name)}if(e.length>0){let i="Arquivos com extensões inválidas ou tamanho do arquivo excedente.\n",t=e.reduce(((e,i)=>e+"\n"+i));return alert(i+t),this._input.value="",!1}return!0};_geraFormData(){let e=new FormData;e.append("filesize_limit",this._maxSize),void 0!==this._id_filecenter_gallery&&/^[0-9]{1,}$/g.test(this._id_filecenter_gallery)&&e.append("id_galeria",this._id_filecenter_gallery);for(let i of this._input.files)e.append("upload2Files[]",i);return e}async send(e=!1){if(!this.verificaArquivosSelecionados())return alert("Arquivos com extensões inválidas ou tamanho do arquivo excedente encontrados!"),null;if(this.isRequired()&&0===this.contaArquivos())return alert("Selecione os arquivos para upload!"),null;if(this._callbacks.antesInserir.length>0)for(let e of this._callbacks.antesInserir)if(!e(this._input.files))return;this._header.delete("Content-Type");let i=this._geraFormData();console.log(this._header);let t=await fetch(this._initialUrl+this._urlBase+(this._uploadTemporario?this._uploadFileTemp:this._uploadFile),{method:"POST",headers:this._header,body:i});if(200===t.status){let i=await t.json();return i.upload&&e&&(this._uploadFileTemp||(this._id_filecenter_gallery=i.id_galeria),this.setaArquivosGaleria(i.dadosGaleria)),i}return alert(await t.text()),{}}}